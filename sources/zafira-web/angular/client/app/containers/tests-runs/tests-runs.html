<div class="page">
    <md-fab-speed-dial id="main-fab" ng-if="getLengthOfSelectedTestRuns() > 0" md-direction="up" class="md-scale md-fab-bottom-right" has-any-permission="['MODIFY_TEST_RUNS', 'TEST_RUNS_CI']">
        <md-fab-trigger>
            <md-button id="mainFab" aria-label="menu" class="md-fab md-primary" md-visible="tooltipVisible">
                <span class="fa fa-bars" aria-hidden="true"></span>
            </md-button>
        </md-fab-trigger>
        <md-fab-actions>
            <md-button id="compareTestRuns" aria-label="menu" class="md-fab md-raised md-fab-sm" ng-if="getLengthOfSelectedTestRuns() > 1 && areTestRunsFromOneSuite()" ng-click="showCompareDialog($event)">
                <md-tooltip md-direction="top">Compare</md-tooltip>
                <span class="fa fa-columns" aria-hidden="true"></span>
            </md-button>
            <md-button id="rerunTestRuns" data-ng-if="jenkinsEnabled" aria-label="menu" class="md-fab md-raised md-fab-sm" data-ng-really-message="Do you really want to rerun multiple test runs?" data-ng-really-click="batchRerun()" has-any-permission="['TEST_RUNS_CI']">
                <md-tooltip md-direction="top">Rerun</md-tooltip>
                <span class="fa fa-undo" aria-hidden="true"></span>
            </md-button>
            <md-button id="deleteTestRuns" aria-label="menu" class="md-fab md-raised md-fab-sm" data-ng-really-message="Do you really want to delete multiple test runs?" data-ng-really-click="batchDelete()" has-any-permission="['MODIFY_TEST_RUNS']">
                <md-tooltip md-direction="top">Delete</md-tooltip>
                <span class="fa fa-trash" aria-hidden="true"></span>
            </md-button>
            <md-button id="abortTestRuns" aria-label="menu" class="md-fab md-raised md-fab-sm" data-ng-really-message="Do you really want to abort multiple test runs?" data-ng-really-click="abortSelectedTestRuns()" has-any-permission="['TEST_RUNS_CI']">
                <md-tooltip md-direction="top">Abort selected test runs</md-tooltip>
                <span class="fa fa-ban" aria-hidden="true"></span>
            </md-button>
            <md-button id="sendTestRunsAsEmail" aria-label="menu" class="md-fab md-raised md-fab-sm" ng-click="batchEmail($event)" data-ng-if="tools['EMAIL']">
                <md-tooltip md-direction="top">Send as email</md-tooltip>
                <span class="fa fa-envelope-o" aria-hidden="true"></span>
            </md-button>
        </md-fab-actions>
    </md-fab-speed-dial>
    <div class="p-tests-runs__section _title row ui-section col-md-2 no-padding no-margin">
        <div class="fixed-search-column no-padding">
            <h1 id="pageTitle" class="p-tests-runs__title  section-header">Test runs
                <span id="itemsCount" ng-if="!$ctrl.isTestRunsEmpty()">({{$ctrl.totalResults}})</span>
            </h1>
        </div>
    </div>
    <div class="p-tests-runs__section _filters row ui-section no-margin">
        <div ng-if="$ctrl.matchMode(['ANY'])" class="fixed-search-column col-md-10 no-padding">
            <button ng-if="$ctrl.matchMode(['APPLY', 'SEARCH'])" id="reset" class="md-button md-raised md-warn md-ink-ripple pull-right" type="button" ng-click="$ctrl.reset();">
                <b>RESET</b>
            </button>
            <button ng-if="$ctrl.matchMode(['SEARCH']);" id="applySearch" class="md-button md-raised md-primary md-ink-ripple pull-right" type="button" ng-click="$ctrl.getTestRuns();">
                <b>APPLY</b>
            </button>
            <button ng-if="$ctrl.matchMode(['CREATE'])" id="createFilter" class="md-button md-raised md-primary md-ink-ripple pull-right" type="button" ng-click="$ctrl.createFilter();" data-ng-disabled="filter_form.$invalid">
                <b>CREATE</b>
            </button>
            <button ng-if="$ctrl.matchMode(['UPDATE'])" id="updateFilter" class="md-button md-raised md-primary md-ink-ripple pull-right" type="button" ng-click="$ctrl.updateFilter();" data-ng-disabled="filter_form.$invalid">
                <b>SAVE</b>
            </button>
            <button ng-if="$ctrl.matchMode(['CREATE', 'UPDATE'])" id="resetFilter" class="md-button md-default md-ink-ripple pull-right" type="button" ng-click="$ctrl.clearAndOpenFilterBlock(false);">
                <b>CANCEL</b>
            </button>
            <button ng-if="$ctrl.matchMode(['UPDATE'])" id="deleteFilter" class="md-button md-raised md-warn md-ink-ripple pull-right" type="button" data-ng-really-message="Do you really want to delete the filter?" data-ng-really-click="deleteFilter(filter.id);">
                <b>DELETE</b>
            </button>
        </div>
        <div class="p-tests-runs__title search-filter-body col-md-12 no-padding">
            <md-card md-table zafira-background-theme="table" class="no-margin-h _md">
                <div id="filter" class="md-row">
                    <div ng-class="{'disable-layer': !$ctrl.searchFormIsEmpty}"></div>
                    <div class="panel-body no-padding-t">
                        <div layout="row" layout-xs="column" ng-show="$ctrl.filterBlockExpand">
                            <div class="manage-chip" ng-click="$ctrl.clearAndOpenFilterBlock(true); $ctrl.addFilterExpanded = true">
                                <md-chips class="filter-chip">
                                    <md-chip>
                                        add filter
                                        <div>
                                            <md-icon class="material-icons">add</md-icon>
                                        </div>
                                    </md-chip>
                                </md-chips>
                            </div>
                            <md-chips class="filter-chip" ng-model="filters" md-removable="false" readonly="true">
                                <input disabled>
                                <md-chip-template>
                                    <div style="display: inline-block;" ng-click="searchByFilter($chip, $mdChipsCtrl); $mdChipsCtrl.selectedChip = $index">
                                        <span>{{$chip.name}}</span>
                                    </div>
                                    <div is-owner="{{ $chip.userId }}" user="{{ currentUser }}" style="display: inline-block; vertical-align: sub;">
                                        <i class="material-icons custom-chip-action show-icon-on-hover" ng-click="chooseFilter($chip);">edit</i>
                                    </div>
                                </md-chip-template>
                            </md-chips>
                        </div>
                    </div>
                </div>
                <div id="filter-editor" ng-show="$ctrl.collapseFilter && $ctrl.filterBlockExpand">
                    <div ng-class="{'disable-layer': !$ctrl.searchFormIsEmpty}"></div>
                    <div class="panel-body">
                        <form class="form-validation no-padding" id="filterForm" name="filter_form" ng-cloak>
                            <div class="filter-text" layout="row" layout-xs="column">
                                <div class="filter-name" layout-xs="column">
                                    <input id="filterName" type="text" class="form-control" placeholder="Name" flex="none" ng-model="filter.name" required/>
                                </div>
                                <div class="flex-auto" layout-xs="column">
                                    <input id="filterDescription" type="text" class="form-control" placeholder="Description" ng-model="filter.description" required/>
                                </div>
                                <md-switch id="filterState" has-any-role="['ROLE_ADMIN']" ng-model="filter.publicAccess" class="md-primary" aria-label="public access">
                                    <span ng-if="filter.publicAccess">Public</span>
                                    <span ng-if="! filter.publicAccess">Private</span>
                                </md-switch>
                            </div>
                        </form>
                        <div layout="row" layout-xs="column">
                            <div class="filter-select" layout-sm="column" layout-xs="column" flex="none">
                                <div layout-sm="row" layout-xs="column">
                                    <md-input-container class="filter-input-container select">
                                        <md-select id="filterCriteria" ng-change="onFilterSliceUpdate('CRITERIA');" ng-model="currentCriteria.value" name="criteria" placeholder="CRITERIA">
                                            <md-option ng-value><em>None</em></md-option>
                                            <md-option class="filter-option" ng-repeat="criteria in subjectBuilder.criterias | orderBy:'name'" ng-value="criteria">
                                                {{ criteria.name.split('_').join(' ') | lowercase }}
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                    <md-input-container class="filter-input-container select">
                                        <md-select id="filterOperator" ng-change="onFilterSliceUpdate('OPERATOR');" ng-disabled="! currentCriteria.value" ng-model="currentOperator.value" name="operator" placeholder="OPERATOR">
                                            <md-option ng-value><em>None</em></md-option>
                                            <md-option class="filter-option" ng-repeat="op in currentCriteria.value.operators" ng-value="op">
                                                {{ op.split('_').join(' ') | lowercase }}
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <md-input-container class="filter-input-container select value-input" ng-if="currentCriteria.type.indexOf('SELECT') >= 0">
                                        <md-select ng-change="onFilterSliceUpdate('VALUE');" ng-disabled="! currentOperator.value"
                                                   ng-model="currentValue.value.value" name="value" placeholder="Value">
                                            <md-option ng-value><em>None</em></md-option>
                                            <md-option class="filter-option" ng-repeat="value in currentCriteria.value.values" ng-value="value">
                                                {{ value.split('_').join(' ') | lowercase }}
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                    <div ng-if="currentOperator.type.indexOf('DATE') >= 0 || (currentCriteria.type.length == 0 && currentOperator.type.length == 0)" class="filter-input-container value-input">
                                        <input type="text" class="form-control" placeholder="Value" ng-disabled="! currentOperator.value"
                                               ng-change="onFilterSliceUpdate('VALUE');" ng-model="currentValue.value" ng-if="currentCriteria.type.length == 0 && currentOperator.type.length == 0"/>
                                        <div ng-if="currentOperator.type.indexOf('DATE') >= 0">
                                            <md-input-container class="date-picker-container no-padding filter-date pull-left no-margin" flex="auto">
                                                <span>{{currentValue.value | date : 'dd MMM'}}</span>
                                                <i class="material-icons md-18 date-picker-icon">today</i>
                                            </md-input-container>
                                            <md-date-range selected-template="TD" ng-model="$ctrl/selectedFilterRange" one-panel="true" auto-confirm="true" show-template="false" md-on-select="selectedDates = $dates; onSelect($dates)"></md-date-range>
                                        </div>
                                    </div>
                                    <button ng-class="{'default-gray': ! currentOperator.value || (! currentValue.value && currentCriteria.type.indexOf('DATE') == -1) || (! currentValue.value && currentCriteria.type.indexOf('DATE') >= 0 && currentOperator.type.indexOf('DATE') >= 0)}" ng-disabled="! currentOperator.value || (! currentValue.value && currentCriteria.type.indexOf('DATE') == -1) || (! currentValue.value && currentCriteria.type.indexOf('DATE') >= 0 && currentOperator.type.indexOf('DATE') >= 0)" ng-click="addChip()" id="add-button" class="quadro-btn default-gray">+</button>
                                </div>
                            </div>
                            <div layout-sm="row" layout-xs="column">
                                <md-chips class="filter-chip filter-chip-scope" ng-model="filter.subject.criterias" readonly="false" md-on-add="changeChip($chip)">
                                    <input disabled>
                                    <md-chip-template>
                                            <span>
                                            <strong>{{$chip.name.split('_').join(' ') | lowercase}}</strong>
                                            <span class="chip-operator">{{ SYMBOLS[$chip.operator] }}</span>
                                            <span ng-if="DATE_CRITERIAS.indexOf($chip.name) == -1 || DATE_CRITERIAS_PICKER_OPERATORS.indexOf($chip.operator) == -1">'{{ $chip.value }}'</span>
                                            <span ng-if="DATE_CRITERIAS.indexOf($chip.name) != -1 && DATE_CRITERIAS_PICKER_OPERATORS.indexOf($chip.operator) != -1">'{{ $chip.value | date : 'MMM dd yyyy' }}'</span>
                                            </span>
                                    </md-chip-template>
                                    <button md-chip-remove class="md-primary filter-slice-chip-button">
                                        <md-icon aria-label="Close dialog">close</md-icon>
                                    </button>
                                </md-chips>
                            </div>
                        </div>
                    </div>
                </div>
                <md-divider></md-divider>
                <div id="search" class="md-row">
                    <div ng-class="{'disable-layer': selectedFilterId}"></div>
                    <div class="panel-body">
                        <div ng-init="fastSearchBlockExpand = true;" ng-show="fastSearchBlockExpand" layout="row" layout-md="column" layout-sm="column" layout-xs="column">
                            <div id="search-container" flex="auto">
                                <div layout="row" layout-xs="column">
                                    <input type="text" id="search-input" class="form-control pull-left" placeholder="Search items" ng-model="fastSearch[fastSearch.currentModel]" aria-label="Search items" aria-describedby="basic-addon2">
                                    <div class="btn-check" layout-xs="row">
                                        <button type="button" ng-class="{'default-gray': fastSearch['testSuite'] && fastSearch['testSuite'].length !== 0, 'active': fastSearch.currentModel === 'testSuite'}" ng-click="fastSearch.currentModel = 'testSuite'" class="btn btn-default">Test Suite</button>
                                        <button type="button" ng-class="{'default-gray': fastSearch['executionURL'] && fastSearch['executionURL'].length != 0, 'active': fastSearch.currentModel == 'executionURL'}" ng-click="fastSearch.currentModel = 'executionURL'" class="btn btn-default">Job URL</button>
                                        <button type="button" ng-class="{'default-gray': fastSearch['appVersion'] && fastSearch['appVersion'].length != 0, 'active': fastSearch.currentModel == 'appVersion'}" ng-click="fastSearch.currentModel = 'appVersion'" class="btn btn-default"> App Version</button>
                                    </div>
                                </div>
                            </div>
                            <div id="search-select" layout="row" layout-sm="column" layout-xs="column">
                                <div layout="row" layout-xs="column">
                                    <div layout="row">
                                        <button class="quadro-btn pull-left reviewed" flex="nogrow" data-ng-class="{'label-blank': sc.reviewed == null, 'label-primary': sc.reviewed == true}" ng-click="sc.reviewed = !sc.reviewed" flex="nogrow">R
                                            <md-tooltip md-direction="bottom">Reviewed</md-tooltip>
                                        </button>
                                        <md-input-container class="searchable select pull-left no-padding" flex="nogrow">
                                            <md-select id="searchStatus" ng-change="onChangeCriteria()" ng-model="sc.status" name="status" placeholder="Status">
                                                <md-option value="" disabled>Status</md-option>
                                                <md-option ng-repeat="status in STATUSES" ng-value="status">{{ status }}</md-option>
                                            </md-select>
                                        </md-input-container>
                                    </div>
                                    <md-input-container class="searchable select pull-left no-padding no-margin-l" flex="grow">
                                        <md-select id="searchEnv" ng-change="onChangeCriteria()" ng-model="sc.environment" name="environment" placeholder="Environment">
                                            <md-option value="" disabled>Environment</md-option>
                                            <md-option ng-repeat="env in environments" ng-value="env">{{env}}</md-option>
                                        </md-select>
                                    </md-input-container>
                                    <md-input-container class="searchable select selectPlatform pull-left" flex="grow">
                                        <md-select id="searchPlatform" ng-change="onChangeCriteria()" ng-model="sc.platform" name="platform" placeholder="Platform">
                                            <md-option value="" disabled>Platform</md-option>
                                            <md-option ng-repeat="platform in platforms" ng-value="platform">{{platform}}</md-option>
                                        </md-select>
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <md-input-container class="date-picker-container pull-left" flex="grow">
                                        <span data-ng-if="selectedRange.dateStart == null && selectedRange.dateEnd == null"></span>
                                        <span data-ng-if="selectedRange.dateStart && selectedRange.dateEnd && !isEqualDate()">{{selectedRange.dateStart | date : 'dd MMM'}} - </span>
                                        <span>{{selectedRange.dateEnd | date : 'dd MMM'}}</span>
                                        <md-button id="searchCalendar" ng-click="pick($event, true)"><i class="material-icons md-18">today</i></md-button>
                                    </md-input-container>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </md-card>
        </div>
    </div>
    <div class="p-tests-runs__section _content row ui-section no-margin">
        <div class="col-md-12 no-padding">
            <article class="article">
                <md-card class="no-margin-h">
                    <test-run-card test-run="testRun" ng-repeat="testRun in $ctrl.testRuns | orderObjectBy:'startedAt':true track by $index" single-mode="false"></test-run-card>
                    <md-table-pagination id="pagination" zafira-background-theme="pagination" ng-if="!$ctrl.isTestRunsEmpty()" md-limit="$ctrl.pageSize" md-limit-options=false md-page="$ctrl.currentPage" md-total="{{$ctrl.totalResults}}" md-page-select=false md-boundary-links=true md-on-paginate="$ctrl.getTestRuns"></md-table-pagination>
                </md-card>
            </article>
        </div>
    </div>
</div>
